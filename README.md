# 원주율(π) 실시간 계산기

FastAPI와 WebSocket을 사용하여 원주율을 실시간으로 계산하고 웹 브라우저에 표시하는 프로그램입니다.

## 📋 목차
- [개요](#개요)
- [주요 기능](#주요-기능)
- [기술 스택](#기술-스택)
- [설치 방법](#설치-방법)
- [실행 방법](#실행-방법)
- [사용 방법](#사용-방법)
- [알고리즘 설명](#알고리즘-설명)
- [주의사항](#주의사항)
- [문제 해결](#문제-해결)

## 개요

Bailey-Borwein-Plouffe (BBP) 공식을 사용하여 원주율을 무한히 계산하며, 계산 과정과 결과를 실시간으로 웹 브라우저와 콘솔에 표시합니다.

## 주요 기능

### 1. 실시간 웹 표시
- WebSocket을 통한 실시간 데이터 전송
- 터미널 스타일 UI (검정 배경 + 초록 텍스트)
- 계산되는 원주율 값을 실시간으로 브라우저에 표시

### 2. 콘솔 로그
- 10번 반복마다 계산 진행 상황 출력
- 50번 반복마다 상세 계산 과정 출력
- 타임스탬프와 함께 각 단계 기록

### 3. 무한 계산
- 초기 정밀도: 100,000자리
- 1000번 반복마다 정밀도 자동 10,000자리씩 증가
- 메모리와 CPU가 허용하는 한 무한히 계속 계산

## 기술 스택

- **Python 3.10+**
- **FastAPI**: 웹 서버 및 WebSocket 지원
- **Uvicorn**: ASGI 서버
- **Decimal**: 고정밀 숫자 계산
- **WebSocket**: 실시간 양방향 통신

## 설치 방법

### 1. Python 설치 확인
```powershell
python --version
```
Python 3.10 이상이 필요합니다.

### 2. 필수 패키지 설치
```powershell
pip install fastapi uvicorn[standard] websockets
```

또는 requirements.txt를 생성하여 설치:
```txt
fastapi
uvicorn[standard]
websockets
```

```powershell
pip install -r requirements.txt
```

## 실행 방법

### 1. 기본 실행
```powershell
cd "c:\Users\user\Downloads\원주율"
python app.py
```

### 2. 직접 실행 (Windows)
```powershell
cd "c:\Users\user\Downloads\원주율"
.\app.py
```

### 3. 서버 시작 확인
다음과 같은 메시지가 출력되면 정상 실행:
```
================================================================================
🚀 FastAPI 원주율 계산 서버 시작
================================================================================
📍 서버 주소: http://localhost:5000
💡 브라우저에서 http://localhost:5000 를 열어주세요
================================================================================
INFO:     Started server process [XXXX]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:5000 (Press CTRL+C to quit)
```

## 사용 방법

### 1. 브라우저 접속
서버 실행 후 웹 브라우저에서 다음 주소로 접속:
```
http://localhost:5000
```

### 2. 자동 계산 시작
- 페이지가 로드되면 자동으로 WebSocket 연결 및 계산 시작
- 브라우저에 원주율 값이 실시간으로 표시됨

### 3. 콘솔 모니터링
터미널/콘솔에서 다음과 같은 로그 확인 가능:
```
[HH:MM:SS.mmm] 반복 #1    | 항: 1.960449000000000e-01 | 현재 π: 3.1960449000000000000000000000...
[HH:MM:SS.mmm] 반복 #10   | 항: 1.205966341632151e-12 | 현재 π: 3.1415926535897932384626433832...
```

### 4. 서버 종료
- 터미널에서 `Ctrl+C` 키 입력
- 또는 터미널 창 닫기

## 알고리즘 설명

### Bailey-Borwein-Plouffe (BBP) 공식

```
π = Σ[k=0 to ∞] (1/16^k) * (4/(8k+1) - 2/(8k+4) - 1/(8k+5) - 1/(8k+6))
```

**특징:**
- 16진수 기반 원주율 계산 알고리즘
- 빠른 수렴 속도
- 특정 자릿수만 계산 가능 (spigot algorithm)

**계산 과정:**
1. 각 k값에 대해 4개의 항 계산 (8k+1, 8k+4, 8k+5, 8k+6)
2. 16의 k제곱으로 나눔
3. 모든 항을 합산하여 π 근사값 계산

## 주의사항

### ⚠️ 중요 경고

#### 1. **무한 실행**
- 이 프로그램은 **무한히 실행**됩니다
- 원주율은 무리수로 마지막 숫자가 존재하지 않습니다
- 자동으로 종료되지 않으며, 수동으로 중단해야 합니다

#### 2. **메모리 사용**
- 초기 메모리: 약 50-100MB
- 1000번 반복마다 정밀도가 10,000자리씩 증가
- 시간이 지날수록 메모리 사용량이 **급격히 증가**
- 예상 메모리 사용: 10,000자리당 약 1-5MB 추가

#### 3. **CPU 사용**
- 계산이 진행될수록 CPU 사용률 증가
- 고정밀 계산은 CPU 집약적 작업
- 장시간 실행 시 CPU 온도 상승 가능

#### 4. **계산 속도**
- 초기: 매우 빠름 (밀리초 단위)
- 1,000자리 이후: 점점 느려짐
- 10,000자리 이후: 매우 느려짐 (초 단위)
- 100,000자리 이후: 극도로 느려짐 (분 단위 이상)

#### 5. **포트 충돌**
- 기본 포트: 5000
- 포트가 이미 사용 중인 경우 에러 발생:
  ```
  ERROR: [Errno 10048] error while attempting to bind on address
  ```
- 해결: 다른 5000번 포트 사용 프로그램 종료 또는 app.py에서 포트 변경

#### 6. **브라우저 제한**
- 브라우저 창을 닫아도 서버는 계속 실행됨
- 메모리 누수 방지를 위해 사용하지 않을 때는 서버 종료 권장

#### 7. **보안**
- 호스트: 127.0.0.1 (로컬호스트만 접근 가능)
- 외부 네트워크에서 접근 불가 (보안상 안전)
- 다른 컴퓨터에서 접속하려면 `host="0.0.0.0"` 변경 필요

### 💡 권장사항

#### 실행 시간 제한
장시간 실행을 원하지 않는다면 `app.py` 수정:

```python
# 현재: while True:
# 수정: 특정 반복 횟수로 제한
max_iterations = 10000  # 원하는 횟수
while k < max_iterations:
    # ... 계산 코드 ...
```

#### 메모리 모니터링
작업 관리자에서 Python 프로세스 메모리 사용량 확인:
- Windows: `Ctrl + Shift + Esc` → 세부 정보 탭
- 메모리가 너무 많이 사용되면 프로그램 종료

#### 정밀도 제한
초기 정밀도 낮추기:

```python
# 현재: getcontext().prec = 100000
# 수정: 더 작은 값으로
getcontext().prec = 10000  # 10,000자리로 제한
```

## 문제 해결

### 1. 포트 충돌 (Errno 10048)
**증상:** 서버 시작 시 포트 바인딩 에러

**해결:**
```python
# app.py 마지막 줄 수정
uvicorn.run(app, host="127.0.0.1", port=5001)  # 포트 번호 변경
```

### 2. WebSocket 연결 실패
**증상:** 브라우저에서 "연결 중..." 상태로 멈춤

**해결:**
- 서버가 실행 중인지 확인
- 방화벽 설정 확인
- 브라우저 콘솔(F12)에서 에러 메시지 확인

### 3. 계산이 너무 느림
**증상:** 특정 시점부터 화면 업데이트가 매우 느림

**해결:**
- 정상 현상 (고정밀 계산의 특성)
- 정밀도 제한 또는 프로그램 재시작

### 4. 메모리 부족
**증상:** 프로그램이 갑자기 종료되거나 시스템이 느려짐

**해결:**
- 프로그램 종료 후 재시작
- 초기 정밀도 낮추기
- 반복 횟수 제한 추가

### 5. 패키지 설치 실패
**증상:** `pip install` 시 에러 발생

**해결:**
```powershell
# pip 업그레이드
python -m pip install --upgrade pip

# 다시 설치
pip install fastapi uvicorn[standard] websockets
```

## 기술 세부사항

### 파일 구조
```
원주율/
├── app.py          # 메인 애플리케이션
└── README.md       # 문서 (이 파일)
```

### 핵심 함수
- `calculate_pi_bbp()`: BBP 공식으로 원주율 계산
- `websocket_endpoint()`: WebSocket 연결 처리
- `get()`: HTML 페이지 제공

### WebSocket 프로토콜
- **연결**: ws://localhost:5000/ws
- **메시지 형식** (JSON):
  ```json
  {
    "current_pi": "3.141592...",
    "iterations": 100,
    "digits": 150,
    "method": "BBP Formula"
  }
  ```

## 라이선스

이 프로젝트는 교육 및 학습 목적으로 제작되었습니다.

## 참고 자료

- [Bailey-Borwein-Plouffe formula (Wikipedia)](https://en.wikipedia.org/wiki/Bailey%E2%80%93Borwein%E2%80%93Plouffe_formula)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Python Decimal Module](https://docs.python.org/3/library/decimal.html)

---

**제작일:** 2025년 11월 29일  
**Python 버전:** 3.10+  
**서버 포트:** 5000 (127.0.0.1)
